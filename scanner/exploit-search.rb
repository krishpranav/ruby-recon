#!/usr/bin/env ruby 
# -*- coding: utf-8 -*-

# requires
require 'nmap/program'

targets = ARGV[0]
time = Time.new
t = time.strftime("%Y-%m-%d-%H:%M:%S")
report = '../reports/nmapscan_' + t.to_s + '_exploitsearch' + '.xml'
puts "############################"
puts "#        Ruby-recon        #"
puts "############################"
puts ""
puts "Report name: #{report}"
ports = 1-65535 #add port here. Use array when setting multiple ports

Nmap::Program.scan do |nmap|
  nmap.target_file = targets
  nmap.ports = ports
  nmap.connect_scan = false
  nmap.udp_scan = false
  nmap.service_scan = true
  nmap.disable_dns = false
  nmap.aggressive_timing = true
  nmap.verbose = true
  nmap.script = 'banner'
  nmap.xml = report
end

puts ""
puts "################################"
puts "#    Searching for exploits    #"
puts "################################"
puts ""
puts "Running: searchsploit --nmap #{report}"
exec "searchsploit --nmap #{report}"