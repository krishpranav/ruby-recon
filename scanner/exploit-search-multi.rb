require 'nmap/program'

puts "############################"
puts "#        Ruby-recon        #"
puts "############################"
puts ""

ports = 1-65525 # add port here 
reports = []
targets = File.open(ARGV[0]).read
targets.each_line do |ip|

    puts "Scanning Ip: #{ip}"
    time = Time.new
    t = time.strftime("%Y-%m-%d-%H:%M:%S")
    ip_address = ip.strip
    report = '../reports/nmapscan_' + t.to_s + "_#{ip_address}_" + 'exploitsearch' + '.xml'
    puts "Report name: #{report}"

    Nmap::Program.scan do |nmap|
        nmap.targets = ip
        nmap.ports = ports
        nmap.connect_scan = false
        nmap.udp_scan = false
        nmap.service_scan = true
        nmap.disable_dns = false 
        nmap.aggressive_timing = true
        nmap.verbose = true 
        nmap.script = 'banner'
        nmap.xml = report
    end

reports.each do |report|

    puts ""
    puts "################################"
    puts "#    Searching for exploits    #"
    puts "################################"
    puts ""
    puts "Running: searchsploit --nmap #{report}"
    system "searchsploit --nmap #{report}"

end
